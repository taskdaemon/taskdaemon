# Phase Loop Type
# Level 3: Takes a Spec phase, produces code/tests in git worktree
parent: spec
description: "Implement a single phase of a Spec in an isolated git worktree"

prompt-template: |
  You are implementing Phase {{phase-number}} of {{total-phases}}: {{phase-name}}

  ## Spec Content
  {{spec-content}}

  {{#if phase-description}}
  ## Phase Description
  {{phase-description}}
  {{/if}}

  {{#if completed-phases}}
  ## Completed Phases
  {{completed-phases}}
  {{/if}}

  ## Current State
  Working directory: {{working-directory}}

  {{#if git-status}}
  Git status:
  {{git-status}}
  {{/if}}

  {{#if git-diff}}
  Git diff (recent changes):
  {{git-diff}}
  {{/if}}

  {{#if progress}}
  ## Previous Iterations
  {{progress}}
  {{/if}}

  {{#if previous-errors}}
  ## Validation Output (failed)
  {{previous-errors}}
  {{/if}}

  ## Instructions
  Implement this phase. Write code, tests, and documentation as needed.
  Commit your changes with a meaningful message.

  When validation passes (tests pass, lints clean), this phase is complete.

validation-command: "otto ci"
success-exit-code: 0
max-iterations: 100
iteration-timeout-ms: 300000

inputs:
  - spec-content
  - phase-name
  - phase-number
  - total-phases
  - phase-description
  - completed-phases
  - working-directory
  - git-status
  - git-diff
  - previous-errors
outputs:
  - committed-code
tools:
  - read_file
  - write_file
  - edit_file
  - list_directory
  - glob
  - grep
  - run_command
  - query_loop
  - share_data
  - complete_task
