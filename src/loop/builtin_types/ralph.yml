# Ralph Loop Type
# Level 4: Takes a Phase document, produces code/tests in git worktree
# This is the implementation step - writes actual code
parent: phase
description: "Implement a Phase document - write code, tests, and documentation"

prompt-template: |
  You are implementing a Phase from a Spec.

  {{#if phase-content}}
  ## Phase Content
  {{phase-content}}
  {{/if}}

  {{#if task-description}}
  ## Task Description
  {{task-description}}
  {{/if}}

  ## Current State
  Working directory: {{working-directory}}

  {{#if files-in-scope}}
  Files in scope:
  {{files-in-scope}}
  {{/if}}

  {{#if git-status}}
  Git status:
  {{git-status}}
  {{/if}}

  {{#if git-diff}}
  Git diff (recent changes):
  {{git-diff}}
  {{/if}}

  {{#if progress}}
  ## Previous Iterations
  {{progress}}
  {{/if}}

  {{#if previous-errors}}
  ## Validation Output (failed)
  {{previous-errors}}
  {{/if}}

  ## Instructions
  Implement this phase. Write code, tests, and documentation as needed.
  Commit your changes with a meaningful message.

  When validation passes (tests pass, lints clean), the phase is complete.

validation-command: "otto ci"
success-exit-code: 0
max-iterations: 100
iteration-timeout-ms: 300000

inputs:
  - phase-content
  - task-description
  - working-directory
  - files-in-scope
  - git-status
  - git-diff
  - previous-errors
outputs:
  - committed-code
tools:
  - read
  - write
  - edit
  - list
  - glob
  - grep
  - bash
  - query_loop
  - share_data
  - complete_task
