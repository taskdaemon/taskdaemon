# Spec Loop Type
# Level 2: Takes completed Plan, produces N Spec markdowns with dependencies
parent: plan
description: "Decompose a Plan into atomic Spec documents with dependencies"

prompt-template: |
  You are decomposing a Plan into Specs (atomic work units).

  ## Plan Content
  {{plan-content}}

  {{#if existing-specs}}
  ## Existing Specs
  {{existing-specs}}
  {{/if}}

  {{#if coverage-gaps}}
  ## Coverage Analysis
  What the Plan covers that Specs don't yet:
  {{coverage-gaps}}
  {{/if}}

  {{#if progress}}
  ## Previous Iterations
  {{progress}}
  {{/if}}

  ## Instructions
  Create Spec documents for uncovered functionality. Each Spec should:
  - Be atomic (completable in one focused session)
  - Have clear acceptance criteria
  - Define phases for implementation
  - Specify dependencies on other Specs (if any)

  **IMPORTANT: Write all output to the specified directory:**
  - Output directory: `{{output-dir}}`

  Create the directory if needed. Write all Spec markdown files to `{{output-dir}}/`.
  Also create an `index.md` in that directory listing all specs.
  Do NOT write to any other location (like td/docs/specs/ or docs/specs/).

  When all Plan functionality is covered by Specs, validation will succeed.

validation-command: "true"  # Spec loops complete via complete_task tool, not validation
success-exit-code: 0
max-iterations: 50
iteration-timeout-ms: 300000

inputs:
  - plan-content
  - existing-specs
  - coverage-gaps
outputs:
  - spec-markdowns
  - specs-jsonl
tools:
  - read
  - write
  - edit
  - list
  - glob
  - grep
  - complete_task
